# API网关

API网关是一个服务器，是系统的唯一入口。从面向对象设计的角度看，它与外观模式类似。API网关封装了系统内部架构，为每个客户端提供一个定制的API。它可能还具有其它职责，如身份验证、监控、负载均衡、缓存、请求分片与管理、静态响应处理。
API网关方式的核心要点是，所有的客户端和消费端都通过统一的网关接入微服务，在网关层处理所有的非业务功能。通常，网关也是提供REST/HTTP的访问API。服务端通过API-GW注册和管理服务。
## 服务注册
POST: https://api.com/register
1. service name
2. service url
3. acl
## 服务发现

## 反向代理
## 负载均衡
- 心跳包
  + 主动　主动访问对应的微服务,且记录API返回的时间数以及访问频率. (GET: https://product.api.com, {"startTime": "xxx", "uptime": "1000000ms", "cpu": "20%", "memory": "80%"})
  + ~~被动 [客户端通知服务端]~~ 单一
- 系统状态包 (动态分配连接数)


### 轮循
### 权重
### 随机
### 最小连接数
## 认证
### 身份认证
### 权限认证
## 日志
## 缓存
## 服务治理
### 熔断
### 降级
### 限流
## 优雅的退出
1. 收到 `SIGINT` 信号
2. 拒绝新请求[请求降级]
3. 等待所有请求执行完毕
4. stop

```
nginx -s quit
kill -2 pid
```